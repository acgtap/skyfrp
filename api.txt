HTTP服务器接口调用文档
========================

基础信息
--------
基础URL: https://mskapi.cnwbhw.com/
服务器地址: 43.242.193.146:8080
请求格式: form-data（表单数据）或 JSON（部分接口）
响应格式: JSON（统一格式）
字符编码: UTF-8

通用响应格式
------------
{
  "code": 0,      // 0表示成功，非0表示失败
  "msg": "消息",
  "timestamp": "时间戳",
  "data": {}      // 可选，返回的数据
}

错误代码说明
-----------
0: 成功
-1: 服务器错误或通用错误
-2: 临时密钥无效或过期
-3: 数据库查询失败
-4: 验证信息不存在或已过期
-7: 验证码已过期
-8: 用户被封禁
-10: 验证码错误

接口列表（共28个接口）
---------------------

1. 邮箱注册接口
接口地址: /api/users_email_register
请求方法: POST
请求格式: form-data
请求参数:
  users_email: string, 必填, 用户邮箱（仅支持QQ邮箱或网易邮箱）
  users_login: string, 必填, 用户名（3-20个字符，支持中文、字母、数字、下划线）
  users_pass: string, 必填, 密码（至少6位）
  verification_code: string, 必填, 邮箱验证码（6位数字）
  invitation_id: string, 可选, 邀请ID，可为NULL
  users_faceimg: string, 可选, 用户头像URL
  register_ip: string, 可选, 注册IP地址（如果不传则使用客户端IP）
说明: 需要先发送注册验证码到邮箱（使用发送邮箱注册验证码接口），验证码有效期为10分钟

2. 获取用户临时密钥接口
接口地址: /api/get_users_key
请求方法: POST
请求格式: form-data
请求参数:
  users_id: integer, 必填, 用户ID（整数）

3. 重置用户临时密钥接口
接口地址: /api/reset_users_key
请求方法: POST
请求格式: form-data
请求参数:
  users_id: integer, 必填, 用户ID（整数）
  temp_key: string, 必填, 现有临时密钥

4. 临时密钥登录接口
接口地址: /api/temp_login
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥

5. 邮箱登录接口
接口地址: /api/email_login
请求方法: POST
请求格式: form-data
请求参数:
  users_email: string, 必填, 用户邮箱
  users_pass: string, 必填, 密码
说明: 使用邮箱和密码进行登录，登录成功后返回临时密钥

6. 卡密验证接口
接口地址: /api/wyzz_kami_key
请求方法: POST
请求格式: form-data
请求参数:
  users_id: integer, 必填, 用户ID（整数）
  kami_data: string, 必填, 卡密数据
卡密类型:
  member: 会员卡密 - 返回会员到期时间
  amount: 余额卡密 - 返回充值金额
  traffic_users: 流量卡密 - 返回增加的流量

7. 更新用户全部数据接口
接口地址: /api/reboot_users_data
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥

8. 获取FRP节点配置接口
接口地址: /api/get_frp_node_config
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
  user_tunnel: string, 必填, 隧道名称

9. 删除FRP隧道接口
接口地址: /api/delete_frp_tunnel
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
  tunnel_name: string, 必填, 隧道名称

10. 创建FRP隧道接口
接口地址: /api/create_frp_tunnel
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
  Tunnel_name: string, 必填, 隧道名称
  Local_ip: string, 必填, 本地IP地址
  Local_port: string, 必填, 本地端口
  node_ip: string, 必填, 节点IP地址
  use_agreement: string, 必填, 使用协议（tcp/http/https）
  return_port: string, 必填, 远程端口
  serverName: string, 可选, 服务器名称（HTTP/HTTPS协议时需要）
  secretKey: string, 可选, 密钥（HTTP/HTTPS协议时需要）

11. 获取用户隧道列表接口
接口地址: /api/get_frp_tunnel_list
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥

12. 获取用户所有数据接口
接口地址: /api/get_users_all_data
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥

13. 用户签到接口
接口地址: /api/users_sign_in
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
说明: 用户每日可签到一次，获得随机流量奖励

14. MSKPro模式接口
接口地址: /api/mskpro_mode
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
  mode: string, 必填, 模式类型

15. 获取QQ登录URL接口
接口地址: /api/qq_login_url
请求方法: GET
请求参数: 无
说明: 返回QQ登录的跳转URL，用户需要跳转到返回的login_url进行QQ授权登录

16. QQ登录回调接口
接口地址: /auth/qq-callback
请求方法: GET
请求参数:
  code: string, 必填, QQ返回的授权码
  state: string, 可选, 防止CSRF攻击的状态参数
  type: string, 可选, 登录类型，默认为qq
  redirect: string, 可选, 设置为1时重定向到前端页面
说明: 使用openid作为用户的唯一标识符（users_uid），新用户自动注册

17. 通用代理接口
接口地址: /api/proxy
请求方法: GET
请求参数:
  url: string, 必填, 目标URL地址
  其他参数: any, 可选, 其他任意参数，将传递给目标URL
说明: 仅支持白名单域名（*.cnwbhw.com）

18. 获取FRP节点列表接口
接口地址: /api/get_frp_nodes
请求方法: GET
请求参数:
  users_id: integer, 必填, 用户ID（整数）
  json: string, 可选, 设置为1时返回JSON格式，否则返回文本格式
  nocolor: string, 可选, 设置为1时禁用文本格式的颜色代码
说明: 支持JSON和文本两种输出格式，文本格式适合命令行工具使用

19. 获取商店商品列表接口
接口地址: /api/get_shop_list
请求方法: GET/POST
请求参数: 无

20. 余额购买商品接口
接口地址: /api/shop_purchase
请求方法: POST
请求格式: form-data
请求参数:
  user_temp_key: string, 必填, 临时密钥
  product_id: integer, 必填, 商品ID

21. 发送邮箱验证码接口
接口地址: /api/send_email_code
请求方法: GET
请求参数:
  email: string, 必填, 邮箱地址
  user_temp_key: string, 必填, 临时密钥
说明: 仅支持QQ邮箱和网易邮箱，验证码有效期为10分钟，用于绑定邮箱

22. 发送邮箱注册验证码接口
接口地址: /api/send_email_register_code
请求方法: POST
请求格式: form-data
请求参数:
  users_email: string, 必填, 用户邮箱（仅支持QQ邮箱或网易邮箱）
说明: 专门用于用户注册时的验证码发送，验证码有效期为10分钟

23. 验证邮箱验证码接口
接口地址: /api/verify_email_code
请求方法: GET
请求参数:
  code: string, 必填, 验证码
  users_id: string, 可选, 用户ID（优先使用）
  users_uid: string, 可选, 用户UID（users_id未提供时使用）
说明: 验证码最多尝试5次，验证成功后验证码立即失效

24. 实名认证初始化接口
接口地址: /api/certification/init
请求方法: POST
请求格式: JSON
请求参数:
  user_temp_key: string, 必填, 临时密钥
  realname: string, 必填, 真实姓名
  idcard: string, 必填, 身份证号码（15或18位）
  cert_type: string, 可选, 认证类型：person/company，默认person

25. 查询认证状态接口
接口地址: /api/certification/status
请求方法: POST
请求格式: JSON
请求参数:
  user_temp_key: string, 必填, 临时密钥
  certify_id: string, 必填, 认证ID

26. 获取认证信息接口
接口地址: /api/certification/info
请求方法: POST
请求格式: JSON
请求参数:
  user_temp_key: string, 必填, 临时密钥

27. 隧道流量查询接口
接口地址: /api/traffic/query

请求方法: POST

请求格式: JSON

请求参数（JSON格式）:
参数名	类型	必填	说明
user_temp_key	string	是	临时密钥
tunnel_name	string	否	单个隧道名称（与tunnel_names二选一）
tunnel_names	array	否	多个隧道名称数组（与tunnel_name二选一）
date_range	string	否	时间范围：today(今天) 或 7days(最近7天)
说明:
1. 支持查询单个隧道、多个隧道或全部隧道的流量使用情况
2. 支持查询今天或最近7天的流量数据
3. 不传隧道相关参数时，默认查询全部隧道

28. 健康检查接口
接口地址: /api/health
请求方法: GET
请求参数: 无

29. 更新用户资料接口
接口地址: /api/update_profile

请求方法: POST

请求格式: form-data

请求参数:
参数名	类型	必填	说明
user_temp_key	string	是	用户临时密钥（用于身份验证）
users_name	string	否	新的用户名（2-20个字符，支持中文、字母、数字、下划线、横线）
users_faceimg	string	否	新的头像地址（必须是有效的HTTP/HTTPS链接）
响应数据:
{
  "code": 0,
  "msg": "资料修改成功",
  "timestamp": "2024-01-01T12:00:00",
  "data": {
    "new_username": "新用户名"
  }
}
说明:
1. 此接口用于修改用户资料，可以修改用户名或头像，或同时修改两者
2. 至少需要提供用户名或头像地址中的一个
3. 用户名长度限制为2-20个字符，支持中文、字母、数字、下划线(_)、横线(-)
4. 用户名必须唯一，不能与其他用户重复
5. 头像地址必须是有效的HTTP或HTTPS链接
6. 用户需要通过临时密钥进行身份验证
7. 修改成功后将返回新的用户名（仅当修改了用户名时）

30. 修改隧道信息接口
接口地址: /api/modify_tunnel_information

请求方法: POST

请求格式: form-data

请求参数:
参数名	类型	必填	说明
user_temp_key	string	是	用户临时密钥（用于身份验证）
mode	string	是	修改模式（port/agreement/localip/return_port）
value	string	是	修改后的值
user_tunnel	string	是	隧道名称
修改模式说明:
模式	说明	value格式要求
port	修改本地端口	1-65535之间的数字
agreement	修改协议类型	tcp/udp/http/https/stcp/sudp/xtcp/xtcpmux
localip	修改本地IP地址	有效的IP地址格式
return_port	修改返回端口	1-65535之间的数字
响应数据:
{
  "code": 0,
  "msg": "修改端口成功",
  "timestamp": "2024-01-01T12:00:00"
}
说明:
1. 此接口用于修改隧道配置信息
2. 隧道正在运行中（tunnel_state为'true'）时禁止修改，需要先停止隧道
3. 端口修改会验证端口是否在1-65535范围内
4. return_port模式会检查节点IP下端口是否唯一
5. 协议修改只支持预定义的8种协议类型
6. IP地址修改会验证IP地址格式
7. 接口有频率限制，防止恶意请求

注意事项
--------
1. 所有POST接口（除特别说明外）均使用form-data格式提交数据
2. 实名认证相关接口使用JSON格式提交数据
3. 部分接口有IP白名单限制（如用户注册接口）
4. 所有接口都有频率限制，频繁请求可能会被暂时禁止
5. 临时密钥（temp_key）是用户身份验证的重要凭证，请妥善保管
6. QQ登录使用第三方服务，回调地址为 http://43.242.193.146:8080/auth/qq-callback
7. 新用户注册后自动获得5G用户流量（长期有效）和5G每月流量
8. 邮箱验证码存储在内存中，服务器重启后失效
9. 验证码有效期为10分钟，最多尝试5次
10. 通用代理接口仅支持白名单域名（*.cnwbhw.com）
11. 发送邮箱注册验证码接口与发送邮箱验证码接口是分开的，分别用于注册和绑定邮箱
12. 邮箱登录接口提供另一种登录方式，使用邮箱和密码进行登录

文档版本: 2026-2-1
基于实际代码实现，包含28个接口
